{"version":3,"sources":["pages/admin section/reports/Usage.js","helpers/datagridExporter.js"],"names":["DS","store","companiesDataLookup","name","RequireFetchData","props","t","useTranslation","companies","PERMISSIONS","basic","title","dataSource","usageDataGrid","showBorders","showColumnLines","columnHidingEnabled","wordWrapEnabled","columnAutoWidth","repaintChangesOnly","remoteOperations","allowColumnResizing","allowColumnReordering","onExporting","datagridExporter","loadPanel","indicatorSrc","LoadingGifImage","mode","visible","dataField","caption","valueExpr","displayExpr","dataType","width","enabled","EXPORT","e","htmlColumns","objectColumns","workbook","ExcelJS","Workbook","worksheet","addWorksheet","i18next","exportDataGrid","component","customizeCell","gridCell","excelCell","rowType","objCol","find","c","column","value","map","v","data","d","fieldName1","fieldName2","displayName","join","htmlToText","wordwrap","Date","toDateString","fill","type","pattern","fgColor","argb","font","italic","then","xlsx","writeBuffer","buffer","saveAs","Blob","cancel"],"mappings":"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","file":"static/js/30.6597d3a0.chunk.js","sourcesContent":["import React from 'react';\r\nimport { Segment } from 'semantic-ui-react';\r\nimport DataGrid, { Column, FilterPanel, FilterRow, Scrolling, SearchPanel, Lookup, Sorting, Export } from 'devextreme-react/data-grid';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { PageHeader } from '../../../components';\r\nimport { usageDataGrid, companiesDataLookup } from '../../../Data Stores';\r\nimport LoadingGifImage from '../../../res/images/loading.gif';\r\nimport datagridExporter from '../../../helpers/datagridExporter';\r\nimport { RequireFetchData } from '../../../middlewares/HOC';\r\n\r\nconst Usage = (props) => {\r\n    const { t } = useTranslation();\r\n    const { companies, PERMISSIONS } = props;\r\n    return (\r\n        <Segment basic>\r\n            <PageHeader title={t('ClientsUsages')} />\r\n            <Segment basic>\r\n                <DataGrid\r\n                    dataSource={usageDataGrid}\r\n                    showBorders\r\n                    showColumnLines\r\n                    columnHidingEnabled\r\n                    wordWrapEnabled\r\n                    columnAutoWidth\r\n                    repaintChangesOnly\r\n                    remoteOperations\r\n                    allowColumnResizing\r\n                    allowColumnReordering\r\n                    onExporting={datagridExporter}\r\n                    loadPanel={{ indicatorSrc: LoadingGifImage }}\r\n                >\r\n                    <Sorting mode='multiple' />\r\n                    <FilterRow visible />\r\n                    <FilterPanel visible />\r\n                    <Scrolling mode=\"infinite\" />\r\n                    <SearchPanel visible />\r\n\r\n                    <Column dataField=\"firstName\" caption={t('FirstName')} />\r\n                    <Column dataField=\"lastName\" caption={t('LastName')} />\r\n                    <Column dataField=\"email\" caption={t('Email')} />\r\n                    <Column dataField=\"mobile\" caption={t('Mobile')} />\r\n                    <Column dataField=\"companyId\" caption={t('Company')}>\r\n                        <Lookup\r\n                            dataSource={companies}\r\n                            valueExpr=\"idCompany\"\r\n                            displayExpr=\"nameEn\"\r\n                        />\r\n                    </Column>\r\n\r\n                    <Column\r\n                        caption={t('Active')}\r\n                        dataType=\"boolean\"\r\n                        dataField='isActive'\r\n                        width={100}\r\n                    />\r\n\r\n                    <Column dataField=\"todayTendersCnt\" caption={t('Number of tenders today')} />\r\n                    <Column dataField=\"subscribeDailyTendersCnt\" caption={t('The number of daily tenders allowed')} />\r\n                    <Column dataField=\"thisMonthTendersCnt\" caption={t('Number of tenders this month')} />\r\n                    <Column dataField=\"subscribeMonthlyTendersCnt\" caption={t('The number of monthly tenders allowed')} />\r\n                    <Column dataField=\"subscribeAccOfferConsum\" caption={t('Number of consumed offers')} />\r\n                    <Column dataField=\"subscribeAccOfferCnt\" caption={t('Total offers allowed')} />  \r\n                    <Export enabled={PERMISSIONS.EXPORT} />\r\n                </DataGrid>\r\n            </Segment>\r\n\r\n        </Segment>\r\n    );\r\n};\r\n\r\nconst DS = [\r\n\r\n    {\r\n        store: companiesDataLookup,\r\n        name: 'companies'\r\n    }\r\n];\r\n\r\nexport default RequireFetchData(Usage, DS);\r\n","import { exportDataGrid } from 'devextreme/exporter/exceljs/export_data_grid';\r\nimport { htmlToText } from 'html-to-text';\r\nimport i18next from 'i18next';\r\nimport saveAs from 'file-saver';\r\nimport ExcelJS from 'exceljs';\r\n\r\nexport default (e, htmlColumns = [], objectColumns = []) => {\r\n    const workbook = new ExcelJS.Workbook();\r\n    const worksheet = workbook.addWorksheet(i18next.t('DataGrid'));\r\n\r\n    exportDataGrid({\r\n        component: e.component,\r\n        worksheet: worksheet,\r\n        customizeCell: ({ gridCell, excelCell }) => {\r\n\r\n            if (gridCell.rowType === 'data') {\r\n                const objCol = objectColumns.find(c => gridCell.column.dataField === c.name);\r\n                if (objCol && gridCell.value) {\r\n                    excelCell.value = gridCell.value.map(v => {\r\n                        const res = objCol.data.find(d => d[objCol.fieldName1] === v[objCol.fieldName2]);\r\n                        return res[objCol.displayName];\r\n                    }).join();\r\n                }\r\n\r\n                if (htmlColumns.find(c => gridCell.column.dataField === c)) {\r\n                    excelCell.value = htmlToText(gridCell.value, { wordwrap: null });\r\n                }\r\n\r\n                if (gridCell.column.dataField === 'creatAt') {\r\n                    excelCell.value = new Date(gridCell.value).toDateString();\r\n                }\r\n                if (gridCell.column.dataField === 'isActive') {\r\n                    excelCell.value = gridCell.value ? i18next.t('YES') : i18next.t('NO');\r\n                }\r\n            }\r\n            if (gridCell.rowType === 'group') {\r\n                excelCell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'BEDFE6' } };\r\n            }\r\n            if (gridCell.rowType === 'totalFooter' && excelCell.value) {\r\n                excelCell.font.italic = true;\r\n            }\r\n        }\r\n    }).then(() => {\r\n        workbook.xlsx.writeBuffer().then((buffer) => {\r\n            saveAs(new Blob([buffer], { type: 'application/octet-stream' }), 'DataGrid.xlsx');\r\n        });\r\n    });\r\n    e.cancel = true;\r\n};"],"sourceRoot":""}